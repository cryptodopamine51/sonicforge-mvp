You are a senior full-stack engineer. Build an MVP “Text-to-Music Generation API” with asynchronous jobs.

Goal:
- Replit hosts the REST API + minimal web UI + job storage.
- A separate GPU worker (Docker, run on GPU server) consumes jobs from Redis, generates music using a local open-source model (MusicGen), applies post-processing, uploads audio to S3-compatible storage, and updates job status in DB.
- Provide OpenAPI docs and example curl commands.

Tech choices:
- API: Python FastAPI, Uvicorn, Pydantic.
- DB: Postgres (preferred). If unavailable in Replit, use SQLite as fallback but keep DB interface compatible with Postgres.
- Queue: Redis.
- Storage: S3-compatible (MinIO/R2/S3).
- Worker: Python, PyTorch, audiocraft (MusicGen), ffmpeg for mp3/wav export, simple loudness normalization & limiter.

API endpoints:
1) POST /v1/generate
   - JSON body:
     - prompt (string, required, max 400)
     - duration_sec (int, 5..30, default 30)
     - format ("mp3"|"wav", default "mp3")
     - seed (int, optional)
     - model (string, default "musicgen-medium")
     - preset (string, optional)
     - generation: {temperature: float, top_k: int, top_p: float, cfg_scale: float}
     - quality: {num_candidates: int 1..8 default 4, rerank: "heuristic_v1", lufs_target: float default -14.0, limiter: bool default true}
   - returns {job_id, status}

2) GET /v1/jobs/{job_id}
   - returns status, progress, timestamps, error

3) GET /v1/jobs/{job_id}/result
   - returns audio_url, selected_candidate, params when succeeded

4) GET /v1/models
   - returns supported models and presets

5) GET /v1/health
   - checks DB + Redis connectivity and worker heartbeat

Auth:
- Require X-API-Key header for /v1/* endpoints.
- API_KEYS is env var with comma-separated keys.

Data model:
- jobs table with fields: id, status, prompt, model, preset, duration_sec, format, seed, generation_params (json), quality_params (json), audio_url, selected_candidate, error, created_at, started_at, finished_at.

Worker requirements (deliver as /worker folder with Dockerfile):
- Reads job_id from Redis queue.
- Fetches job details from DB.
- Loads MusicGen model with caching (do not reload per job).
- Generates N candidates using different seeds derived from base seed.
- Select best candidate using heuristic: avoid clipping, target loudness, minimal excessive high-frequency noise.
- Post-process: normalize loudness to LUFS target, apply limiter, encode to mp3/wav via ffmpeg.
- Upload to S3 and store audio_url.
- Update job status to succeeded/failed and set error text on failure.

Project structure:
- /api (FastAPI app)
- /worker (consumer + generation pipeline + Dockerfile)
- /shared (pydantic schemas, db models)
- Include README with:
  - env vars
  - local run steps
  - how to run worker on GPU machine
  - curl examples
  - OpenAPI URL

Important:
- Provide robust error handling and validation.
- Asynchronous job processing with queue.
- Minimal UI page in Replit: prompt form + duration + format + generate button; polls job status and plays resulting audio.

Deliver complete working code in the Replit project.
